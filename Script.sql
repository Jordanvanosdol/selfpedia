-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- ------______   ______    _     -----------------------------------------------------------------------------------------------------------------------------------------
-- ------|D _  \--|D _  \--|L|    -----------------------------------------------------------------------------------------------------------------------------------------
-- ------| | \  \-| | \  \-| |    -----------------------------------------------------------------------------------------------------------------------------------------
-- ------| |  )  )| |  )  )| |    -----------------------------------------------------------------------------------------------------------------------------------------
-- ------| |_/  /-| |_/  /-| |____-----------------------------------------------------------------------------------------------------------------------------------------
-- ------|_____/--|_____/--|______|----------------------------------------------------------------------------------------------------------------------------------------
-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Creates the UserAccount table, first entry, and "next available PK" stored proceudure ----------------------------------------------------------------------------------
-- vvv---------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE UserAccount (
    PersonID int primary key,
    username varchar(50) unique,
    userpass varchar(50) not null,
    LastName varchar(255) not null,
    FirstName varchar(255) not null,
    Email varchar(255) unique,
    CreateTS timestamp,
    LastUpdateTS timestamp
);

INSERT INTO UserAccount (PersonID, username, userpass, LastName,FirstName,Email,CreateTS,LastUpdateTS) 
VALUES (1, 'FORBIDDEN', 'FORBIDDEN', 'FORBIDDEN', 'FORBIDDEN', 'FORBIDDEN', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP );

CREATE DEFINER=`root`@`localhost` PROCEDURE `Selfpedia`.`next_available_useraccount_id`()
begin
	SELECT  a1.PersonID+ 1 next_id 
	FROM UserAccount a1
	where A1.PersonID+1 not in (SELECT  a2.PersonID
						  		FROM UserAccount a2)
	ORDER BY a1.PersonID asc
	LIMIT 1;
end

-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Creates the Entry table, first entry, and "next available PK" stored proceudure ----------------------------------------------------------------------------------------
-- vvv---------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE Entry (
    ContentId int primary key,
    contentTitle varchar(255) not null,
    contentAuther int not null,
    contentBody text not null,
    CreateTS timestamp,
    LastUpdateTS timestamp
);

INSERT INTO Entry (ContentId,contentTitle,contentAuther,contentBody,CreateTS,LastUpdateTS) 
VALUES (1, 'FORBIDDEN', 1, 'FORBIDDEN', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP );

CREATE DEFINER=`root`@`localhost` PROCEDURE `Selfpedia`.`next_available_entry_id`()
begin
	SELECT  a1.ContentId+ 1 next_id 
	FROM Entry a1
	where A1.ContentId+1 not in (SELECT  a2.ContentId
							  FROM Entry a2)
	ORDER BY a1.ContentId asc
	LIMIT 1;
end

-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Creates the Tag table---------------------------------------------------------------------------------------------------------------------------------------------------
-- vvv---------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE Tag (
    ContentId int,
    tagName varchar(255),
    PRIMARY KEY (ContentId, tagName)
);

-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- ------______    __     __   _     -------------------------------------------------------------------------------------------------------------------------------------
-- ------|D _  \--|M \   /  |-|L|    --------------------------------------------------------------------------------------------------------------------------------------
-- ------| | \  \-|   \_/   |-| |    --------------------------------------------------------------------------------------------------------------------------------------
-- ------| |  )  )| |\   /| |-| |    --------------------------------------------------------------------------------------------------------------------------------------
-- ------| |_/  /-| | \_/ | |-| |____--------------------------------------------------------------------------------------------------------------------------------------
-- ------|_____/--|_|     |_|-|______|-------------------------------------------------------------------------------------------------------------------------------------
-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------



drop table UserAccount;
drop table Entry;
drop table Tag;


CALL next_available_useraccount_id;
CALL next_available_entry_id;